---
title: "Sex Specific Contributions Exploratory Analysis"
output: 
  html_document: 
    keep_md: true
date: "2024-02-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(naniar)
library(janitor)
```

```{r}
dataset <- read_delim("data/Sex_specific_contribution.csv", delim=";") %>% clean_names()
```
First, we look at our dataset and look for null or NA values. 
```{r}
glimpse(dataset)
```
```{r}
summary(dataset)
```
```{r}
miss_var_summary(dataset)
```

There appear to be NAs, but are all accurately represented as NAs. 

1. We want to understand the distribution of sexes. 

```{r}
sex_distribution <- dataset %>% 
  ggplot(aes(x=nest_builder, fill=nest_builder)) + 
  geom_bar() + 
  theme(legend.position = "none",
        axis.text.x = element_text(angle=50, hjust=1)) +
  labs(title="Distribution of Nest Builder Sex",
       x="Nest Builder", 
       y="Count",
       fill="Nest_builder")

sex_distribution + scale_fill_brewer(palette="BrBG")
```
We see that the most common nest builder is female, followed by both parents, then neither, and the least common (which is very uncommon) is a male nest builder.

Who are the male nest builders?
```{r}
dataset %>% 
  select(species, nest_builder) %>% 
  filter(nest_builder == "male")
```

2. Do other factors have correlations with the sex of the nest builder?

Let's look at how nest site and nest builder correlate.

```{r}
builder_vs_site <- dataset %>% 
  ggplot(aes(x=nest_builder, fill=nest_builder)) + 
  geom_bar() +
  theme(axis.text.x = element_text(angle=50, hjust=1)) +
  labs(title="Nest Builder Sex by Site",
       x="Nest Builder", 
       y="Count",
       fill="Nest_builder") + 
  facet_wrap(~nest_site)

builder_vs_site + scale_fill_brewer(palette="BrBG")
```
We see that females tend to take the lead in ground and grass reed nest building. Both parents tend to be more involved in ground holes, ledges, tree bushes, walls, and water, while neither may do work in tree holes. 

Here's another way of visualizing the same info:
```{r}
dataset %>% 
  ggplot(aes(x=nest_site, fill=nest_builder)) +
  geom_bar(position = "dodge") +
  theme(axis.text.x = element_text(angle=50, hjust=1)) +
  labs(title="Nest Site by Sex of Builder",
       x="Site", 
       y="Count",
       fill="Nest Builder") +
  scale_fill_brewer(palette="BrBG")
```

We'll also take a look at how nest structure and nest builder correlate.
```{r}
builder_vs_type <- dataset %>% 
  filter(nest_builder != "neither") %>% 
  ggplot(aes(x=nest_builder, fill=nest_builder)) + 
  geom_bar(color="black") +
  theme(axis.text.x = element_text(angle=50, hjust=1)) +
  labs(title="Nest Builder Sex by Nest Structure",
       x=NULL, 
       y="Count",
       fill="Nest Builder") + 
  facet_wrap(~nest_structure)

builder_vs_type + scale_fill_brewer(palette="BrBG")
```

Alternatively:
```{r}
dataset %>% 
  filter(nest_builder != "neither") %>% 
  ggplot(aes(x=nest_structure, fill=nest_builder)) +
  geom_bar(position = "dodge", color="black") +
  theme(axis.text.x = element_text(angle=50, hjust=1)) +
  labs(title="Nest Structure by Builder Sex",
       x="Site", 
       y="Count",
       fill="Nest Builder") +
  scale_fill_brewer(palette="BrBG")
```

3. How does the sex of the nest builder correlate with our continuous variables?

Nest builder and mean clutch size:
```{r}
dataset %>% 
  filter(nest_builder != "neither") %>%
  filter(clutch_size_mean != "NA") %>% 
  ggplot(aes(x=nest_builder, y=clutch_size_mean, 
             fill=nest_builder)) +
  geom_boxplot() +
  labs(title="Mean Clutch Size by Builder Sex",
       x=NULL, 
       y="Mean Clutch Size",
       fill="Nest Builder") +
  scale_fill_brewer(palette="BrBG")
```

4. incubating_sex... nest builder
```{r}
na.omit(dataset) %>%
ggplot(aes(x = latitude_mean, y = clutch_size_mean)) +
  geom_density_2d() +
  labs(x = "Latitude (Mean)", y = "Clutch Size (Mean)")

```
--- 

4. lets see how clutch sizes is related to latitude and whether nest types are related to that. 

```{r}

na.omit(dataset) %>%
   filter(nest_builder != "neither") %>%
ggplot( aes(x = latitude_mean, y = clutch_size_mean, color = nest_structure)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, aes(group = nest_structure)) + # Grouping for separate regression lines
  labs(x = "Latitude Mean", y = "Mean Clutch Size", title = "Clutch Size vs. Latitude by Nest Structure") +
  theme_minimal() +
  scale_color_manual(values = c("cup" = "blue", "platform" = "red", "dome"="green", "no nest"="purple")) # Adjust keys and colors
```

5. Analyze clutch size mean by latitude mean while considering the sex-based role in nest building

```{r}


na.omit(dataset) %>%
   filter(nest_builder != "neither") %>%
ggplot( aes(x=as.factor(nest_builder), y=clutch_size_mean)) +
  geom_boxplot() +
  facet_wrap(~nest_builder) +
  labs(title="Clutch Size by Nest Builder", x="Nest Builder", y="Clutch Size Mean")


```

5. Now, we want to explore to see if different latitudes have any effects on breeding season

```{r}


na.omit(dataset) %>%
   filter(nest_builder != "neither") %>%
ggplot( aes(x = latitude_mean, y = length_breeding)) +
  geom_point() +  
  geom_smooth(method = "loess", color = "blue") +  
  labs(title = "Breeding Season Length Across Latitudes",
       x = "Latitude Mean",
       y = "Breeding Season Length") +
  theme_minimal()


```
6. Now, lets see nest structure distribution

```{r}

na.omit(dataset) %>%
   filter(nest_builder != "neither") %>%
ggplot( aes(x = nest_structure)) +
  geom_bar(aes(fill = nest_structure), show.legend = FALSE) +
  labs(title = "Nest Structure Distribution", x = "Nest Structure", y = "Count") +
  theme_minimal()



```
7. Let's see if different sexes have a preference in the type of nest they build

```{r}

na.omit(dataset) %>%
   filter(nest_builder != "neither") %>%
ggplot( aes(x = nest_structure, fill = nest_builder)) +
  geom_bar(position = "dodge") +
  labs(title = "Nest Structure Distribution by Sex", x = "Nest Structure", y = "Count") +
  theme_minimal()



```

7. Let's check whether clutch size has anything to do with the sex of the parent that builds the nest. That tells us about the fitness

```{r}

na.omit(dataset) %>%
   filter(nest_builder != "neither") %>%
ggplot( aes(x = nest_builder, y = clutch_size_mean, fill = nest_builder)) +
  geom_boxplot() +
  labs(title = "Clutch Size by Nest Builder Sex", x = "Nest Builder Sex", y = "Mean Clutch Size") +
  theme_minimal()

```
8. breeding season length by latitude
```{r}
na.omit(dataset) %>%
   filter(nest_builder != "neither") %>%
ggplot( aes(x = nest_builder, y = length_breeding, fill = nest_builder)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Breeding Season Length by Nest Builder",
       x = "Nest Builder",
       y = "Breeding Season Length (months)") +
  scale_fill_brewer(palette = "Set1")
```
9. The study checked:"species in which females lay larger clutch sizes and incubate eggs alone are more likely to have nests built by females alone"

```{r}
na.omit(dataset) %>%
 ggplot(aes(x = clutch_size_mean)) +
  geom_histogram(aes(fill = incubating_sex), bins = 30, alpha = 0.6, position = "identity") +
  facet_wrap(~nest_builder) +
  labs(title = "Distribution of Clutch Size Mean by Incubating Sex and Nest Builder",
       x = "Clutch Size Mean",
       y = "Frequency") +
  scale_fill_brewer(palette = "Set1") +
  theme_minimal()
```
10. The study also checked whether: " sex-specific nest building contributions were predictably related to nest site and structure, as species in which females built nests alone were more likely to have open cup nests relative to enclosed, domed nests of species in which both parents build."

```{r}

na.omit(dataset) %>%
  filter(nest_structure %in% c('cup', 'dome')) %>%
  ggplot(aes(x = nest_builder, fill = nest_structure)) +
  geom_bar(position = "dodge") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(title = "Nest Structure by Builder Contribution",
       x = "Nest Builder",
       y = "Percentage of Nest Types",
       fill = "Nest Structure") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set2")
```


_The code/plots for the other continuous variables would be similar._